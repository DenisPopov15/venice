#!/bin/sh

if [ "$*" == "" ]; then
  echo "Please provide host/api, see: https://cloud.digitalocean.com/droplets"
  exit 1
fi

HOST="$1"
GIT_URL=$(git config --get remote.origin.url)

if (ssh root@$HOST '[ -d ~rails/rails_project ]' ); then
  ssh root@$HOST "bash -s" < ./bin/do/update
else
  ssh root@$HOST 'dd if=/dev/zero of=/swapfile bs=1024 count=512k ; mkswap /swapfile ; swapon /swapfile ; swapon -s'
  ssh root@$HOST "bash -s" < ./bin/do/setup "$GIT_URL" "$HOST"
fi
